<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" /> <title>Spread Pool — Week 1</title>

<style>
:root{
  --bg:#0d1117; --card:#111827; --text:#e6edf3; --muted:#9aa1b1; --border:#263142;
  --chip:#1f2937; --accent:#2563eb;
  --yellow:#ffcc15; --yellowText:#000;
  --bad:#b42318;
  /* Chicago Bears colors for success pill */
  --bearsNavy:#0B162A;
  --bearsOrange:#DC4405;
}
*{box-sizing:border-box}
body{
  margin:0;background:var(--bg);color:var(--text);
  font-family:system-ui,Segoe UI,Roboto,Helvetica,Arial,sans-serif;font-size:16px;line-height:1.35;
}
.wrap{max-width:1150px;margin:0 auto;padding:24px}
h1{margin:0 0 18px 0;font-size:28px}
h2{margin:0 0 12px 0;font-size:20px}
.small{font-size:.92rem}.muted{color:var(--muted)}
.card{background:var(--card);border:1px solid var(--border);border-radius:12px;padding:16px;margin:12px 0} .grid{display:grid;grid-template-columns:1fr;gap:14px}
@media(min-width:980px){.grid{grid-template-columns:1fr 1fr}}

.row{
  display:grid;
  grid-template-columns:1fr auto minmax(290px,1fr); /* info | (spacer) | answers */
  gap:10px;align-items:center;
  padding:10px;border-radius:10px;
  background:rgba(255,255,255,.02);border:1px solid var(--border) } .label{font-weight:800} .details{font-size:.95rem} .hdr{display:flex;align-items:center;justify-content:space-between}

.badge{
  display:inline-flex;align-items:center;justify-content:center;border-radius:999px;
  padding:6px 12px;font-weight:800
}
.badge.required{background:var(--yellow);color:var(--yellowText)}
.badge.expired{background:#d92d20;color:#fff}

.answers{display:block;max-width:34rem}
.answers label{
  display:flex;align-items:center;gap:8px;margin:6px 0;cursor:pointer;
  white-space:nowrap;overflow:hidden;text-overflow:ellipsis
}
.answers input{transform:translateY(1px)} .badges-under{margin-top:8px;display:flex;gap:8px;flex-wrap:wrap}

.clear{display:inline-block;background:transparent;border:1px solid #3b4553;border-radius:8px;color:var(--muted);padding:6px 10px;cursor:pointer;margin-top:8px}
.clear:hover{background:#2a3442;color:#fff}

/* Checks & Errors list */
.checklist{margin:8px 0 0 0;padding:0;list-style:none;display:grid;gap:6px}
.checklist li{display:flex;align-items:center;gap:10px;background:rgba(255,255,255,.02);border:1px solid var(--border);border-radius:10px;padding:8px 10px} .check-icon{
  width:22px;height:22px;border-radius:50%;display:inline-flex;align-items:center;justify-content:center;
  font-weight:900;font-size:.9rem;flex:0 0 22px } .check-ok  .check-icon{background:#1f883d;color:#fff}
.check-bad .check-icon{background:#b42318;color:#fff}
.check-text{flex:1 1 auto}

/* footer */
footer{position:sticky;bottom:0;left:0;right:0;z-index:9}
.footer{
  display:flex;justify-content:space-between;align-items:center;gap:8px;
  background:rgba(16,23,33,.85);backdrop-filter:blur(6px);
  border-top:1px solid var(--border);padding:10px 14px } .btn{border:none;border-radius:10px;padding:10px 14px;font-weight:700;cursor:pointer}
.btn[disabled]{opacity:.5;cursor:not-allowed}
.btn.primary{background:#238636;color:#fff}
.btn.ghost{background:#2a3442;color:#d0d7de}
.statusBox{font-weight:900;border:1px solid var(--border);border-radius:999px;padding:8px 14px} .status_bad{background:var(--bad);color:#fff}
/* Bears colors when all checks pass */
.status_good{background:var(--bearsNavy);color:var(--bearsOrange);border-color:var(--bearsNavy)}

/* demo chip */
.demo{position:fixed;top:14px;right:14px;background:#a15;color:#fff;border-radius:999px;padding:8px 12px;font-weight:800;z-index:10;box-shadow:0 6px 18px rgba(0,0,0,.35)} </style> </head> <body> <div class="wrap">
  <h1>Spread Pool — Week 1</h1>

  <!-- Participant -->
  <section class="card">
    <h2>Participant</h2>
    <div class="grid" style="grid-template-columns:1fr 1fr">
      <div>
        <label for="nameSel" class="small muted">Choose your name</label>
        <select id="nameSel" style="width:100%;margin-top:6px"></select>
      </div>
      <div>
        <label for="emailBox" class="small muted">Your email (auto-filled; editable)</label>
        <input id="emailBox" type="email" placeholder="you@example.com" style="width:100%;margin-top:6px;padding:8px;border-radius:8px;border:1px solid var(--border);background:var(--card);color:var(--text)" />
      </div>
    </div>
    <p class="small muted" style="margin-top:8px">One email is sent to the organizer and you’ll be CC’d.</p>
  </section>

  <!-- A + B sections -->
  <section class="grid">
    <div class="card" id="secA">
      <div class="hdr"><h2>NFL (Section A)</h2><span class="badge" id="cntA">Answered: 0</span></div>
      <div id="listA" class="vstack small muted">Loading NFL…</div>
    </div>

    <div class="card" id="secB">
      <div class="hdr"><h2>College (Section B)</h2><span class="badge" id="cntB">Answered: 0</span></div>
      <div id="listB" class="vstack small muted">Loading NCAA…</div>
    </div>
  </section>

  <!-- Double -->
  <section class="card">
    <h2>Optional: Choose ONE “Double”</h2>
    <select id="doubleSel"><option value="">No double</option></select>
    <p class="small muted">Only your currently selected, unexpired games appear here.</p>
  </section>

  <!-- Checks & Errors -->
  <section class="card">
    <h2>Checks &amp; Errors</h2>
    <p class="small muted">
      Rules: select your name &amp; valid email; answer all games marked
      <span class="badge required">Required</span>; ≥3 in NFL and ≥3 in College; total 7–12 picks;
      if you choose a Double, it must be one of your selections.
    </p>

    <ul id="checkList" class="checklist">
      <li id="chkName"     class="check-bad"><span class="check-icon">✕</span><span class="check-text">Name selected</span></li>
      <li id="chkEmail"    class="check-bad"><span class="check-icon">✕</span><span class="check-text">Valid email</span></li>
      <li id="chkReqNFL"   class="check-bad"><span class="check-icon">✕</span><span class="check-text">Mandatory NFL game picked</span></li>
      <li id="chkReqNCAA"  class="check-bad"><span class="check-icon">✕</span><span class="check-text">Mandatory College game picked</span></li>
      <li id="chkAtLeastA" class="check-bad"><span class="check-icon">✕</span><span class="check-text">≥ 3 answers in NFL</span></li>
      <li id="chkAtLeastB" class="check-bad"><span class="check-icon">✕</span><span class="check-text">≥ 3 answers in College</span></li>
      <li id="chkRange"    class="check-bad"><span class="check-icon">✕</span><span class="check-text">Between 7 and 12 total games</span></li>
      <li id="chkDouble"   class="check-bad"><span class="check-icon">✕</span><span class="check-text">If Double chosen, it’s one of your selections</span></li>
      <li id="chkDeadline" class="check-bad"><span class="check-icon">✕</span><span class="check-text">Global picks deadline not passed</span></li>
    </ul>
  </section>

  <!-- Summary -->
  <section class="card">
    <h2>Summary of Chosen Answer(s)</h2>
    <div id="summary"><p class="small muted">Your selections will appear here.</p></div>
  </section>

  <!-- Footer -->
  <footer>
    <div class="footer">
      <div class="l">
        <button id="submitBtn" class="btn primary">Submit</button>
        <button id="resetBtn"  class="btn ghost">Reset</button>
      </div>
      <div class="r">
        <span id="statusBox" class="statusBox status_bad">ERRORS DETECTED</span>
      </div>
    </div>
  </footer>
</div>

<div id="demoBadge" class="demo" hidden>DEMO MODE</div>

<script>
/* ===================== CONFIG ===================== */
/* Replace with your Publish‑to‑web CSV links (must end with output=csv) */ 
const CSV_URL_PARTICIPANTS = "https://docs.google.com/spreadsheets/d/e/2PACX-1vTfQ7a2weK5Got7LTe3yVxqhcPR6pa-nPg73PdOMk8rrHwqlr3UeTcPprlgVbFjhFIVpifmMKnb_Tss/pub?gid=0&single=true&output=csv"; // Name, Email
const CSV_URL_NFL          = "https://docs.google.com/spreadsheets/d/e/2PACX-1vSu8cw2ymTbcJGMmBkbcJTNzvxVsl4wh3XH7pbQJ3_pbSz42LFo0HKQHVLcJtHiOqtEDt37-hSegjDK/pub?gid=2109553148&single=true&output=csv";          // Away Team, Home Team, Date, Time, TV, Location, Spread, Required
const CSV_URL_NCAA         = "https://docs.google.com/spreadsheets/d/e/2PACX-1vSu8cw2ymTbcJGMmBkbcJTNzvxVsl4wh3XH7pbQJ3_pbSz42LFo0HKQHVLcJtHiOqtEDt37-hSegjDK/pub?gid=0&single=true&output=csv";

/* Week label for subject lines, summaries, etc. */ 
const CURRENT_WEEK = 1;

/* UTC cut-off for the WHOLE form (block all submissions after this moment). */ const PICKS_DEADLINE_UTC = "2025-08-31T23:59:00Z";

/* Email (demo mode suppresses sending but shows “Submitted”) */

const EMAILJS_SERVICE_ID  = "service_txqdfck"; 
const EMAILJS_TEMPLATE_ID = "template_o8du7pt"; 
const EMAILJS_PUBLIC_KEY  = "w4UC6ofDTC0VdRI44";

/* Set true to suppress real emails but show “Submitted!” flow. */ const DEMO_MODE = false;
/* ======================  END CONFIG  ======================= */

/* =============== HELPERS =============== */ const $ = s => document.querySelector(s); const $$ = s => [...document.querySelectorAll(s)];
const escapeHtml = s => String(s??"").replace(/[&<>"]/g,m=>({ "&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;" }[m]));

/* cache-busted fetch so sheet edits appear quickly */ function fetchCSV(url){
  const bust = (url.includes("?") ? "&" : "?") + "_=" + Date.now();
  return fetch(url + bust, {mode: "cors"})
    .then(r => { if(!r.ok) throw new Error("CSV fetch failed: "+r.status); return r.text(); }); }

/* CSV → array of objects */
function parseCSV(text){
  const rows = text.trim().split(/\r?\n/).map(r=>r.split(/,(?=(?:[^"]*"[^"]*")*[^"]*$)/).map(c=>c.replace(/^"|"$/g,"")));
  const hdr = rows.shift();
  return rows.map(r => Object.fromEntries(hdr.map((h,i)=>[h.trim(), (r[i]??"").trim()]))); }

/* Parse a Date + Time written in EASTERN time into a local (viewer) time string,
   and produce an ISO UTC deadline for expiration checks.
   Date like “Sept 6, 2025”, Time like “12:00 PM”. */ function easternToLocalStrings(dateStr, timeStr){
  if(!dateStr) return { day:"—", time:"—", isoUTC:null };

  // Build an ET Date as if in America/New_York, then convert to the same absolute instant.
  // First, try Intl format:
  try{
    // We build a UTC-ish string by parsing with Date and adjusting with a known offset from ET at that date.
    // Simpler: create a Date from an American locale string then compute ET offset with Intl.
    const guess = new Date(`${dateStr} ${timeStr || "12:00 PM"} EDT`);
    if (isNaN(guess)) throw 0;
    // Format to viewer
    const day = new Intl.DateTimeFormat(undefined,{weekday:"long"}).format(guess);
    const time = new Intl.DateTimeFormat(undefined,{hour:"numeric",minute:"2-digit"}).format(guess);
    const isoUTC = new Date(guess.getTime()).toISOString();
    return { day, time, isoUTC };
  }catch(e){
    // Best effort fallback
    const d = new Date(`${dateStr} ${timeStr||""}`);
    if (isNaN(d)) return { day:"—", time:"—", isoUTC:null };
    const day = new Intl.DateTimeFormat(undefined,{weekday:"long"}).format(d);
    const time = new Intl.DateTimeFormat(undefined,{hour:"numeric",minute:"2-digit"}).format(d);
    return { day, time, isoUTC: d.toISOString() };
  }
}

/* Derive favorite string from Spread text, e.g., "SMU -3.0" → "SMU -3.0" */ function favoriteFromSpread(away, home, spreadRaw){
  const s = String(spreadRaw||"").trim();
  if(!s) return "—";
  // Expect "<Team> -N" or "<Team> (+N)"; otherwise pass through
  return s;
}

/* Build a normalized game record */
function normalizeGames(csvRows, wantA/*true for NFL*/){
  const rows = [];
  csvRows.forEach(r=>{
    const qid   = String(r["QID"]||"").trim();
    if(!qid) return;
    const away  = String(r["Away Team"]||"").trim();
    const home  = String(r["Home Team"]||"").trim();
    const dateS = String(r["Date"]||"").trim();
    const timeS = String(r["Time"]||"").trim();
    const tv    = String(r["TV"]||r["Channel"]||"").trim();
    const loc   = String(r["Location"]||"").trim();
    const spread= String(r["Spread"]||"").trim();        // if empty, we skip this game
    const req   = /y/i.test(String(r["Required"]||""));

    if(!spread) return; // only list games with a line

    const fav = favoriteFromSpread(away,home,spread);
    const {day, time, isoUTC} = easternToLocalStrings(dateS, timeS);

    rows.push({
      qid, line:`${away} @ ${home}`, fav, day, time, tv, loc,
      deadlineIso: isoUTC, req, choices:[`${away}`, `${home}`], spread
    });
  });

  // Required games first, then by line for stability
  rows.sort((a,b)=> (b.req - a.req) || a.line.localeCompare(b.line));
  return rows;
}

/* =============== RENDER =============== */ function buildRow(q){
  const el = document.createElement("div");
  el.className = "row";
  el.dataset.qid = q.qid;
  el.dataset.deadline = q.deadlineIso || "";

  // choices (vertical, with spread/favorite text echoed on right)
  const answers = q.choices.map((c,i)=>`
    <label>
      <input type="radio" name="${escapeHtml(q.qid)}" value="${escapeHtml(c)}">
      ${escapeHtml(c)} ${i===0 && q.spread && q.spread.includes(q.choices[0]) ? "" : ""}
    </label>
  `).join("");

  el.innerHTML = `
    <div>
      <div class="label">${escapeHtml(q.line)}</div>
      <div class="details">
        <div><strong>Favorite:</strong> ${escapeHtml(q.fav)}</div>
        <div><strong>Day:</strong> ${escapeHtml(q.day)}</div>
        <div><strong>Time:</strong> ${escapeHtml(q.time)}</div>
        <div><strong>Channel:</strong> ${escapeHtml(q.tv || "—")}</div>
        <div><strong>Location:</strong> ${escapeHtml(q.loc || "—")}</div>
      </div>
      <div class="badges-under">
        ${q.req ? `<span class="badge required">Required</span>` : ``}
        <span class="badge expired" hidden>Expired</span>
      </div>
    </div>
    <div></div>
    <div class="answers">
      ${answers}
      <button type="button" class="clear" data-clear="${escapeHtml(q.qid)}">Clear</button>
    </div>
  `;
  return el;
}

function renderSection(container, rows){
  container.innerHTML = "";
  if(!rows.length){
    container.innerHTML = `<p class="small muted">No games found (check sheet headers and “Spread” column).</p>`;
    return;
  }
  rows.forEach(q => container.appendChild(buildRow(q)));
}

/* =============== STATE / VALIDATION =============== */ function nowUTC(){ return new Date(); }

function isExpired(el){
  const iso = el.dataset.deadline || "";
  if(!iso) return false;
  return nowUTC() > new Date(iso);
}

function refreshExpiryUI(){
  $$(".row").forEach(el=>{
    const exp = isExpired(el);
    const expiredBadge = el.querySelector(".badge.expired");
    const inputs = el.querySelectorAll('input[type="radio"]');
    if(exp){
      expiredBadge.hidden = false;
      inputs.forEach(i=>{ i.disabled = true; i.checked = false; });
    }else{
      expiredBadge.hidden = true;
      inputs.forEach(i=> i.disabled = false);
    }
  });
}

function selectionCounts(){
  const a = $$(`#listA input[type="radio"]:checked`).length;
  const b = $$(`#listB input[type="radio"]:checked`).length;
  return {a,b,total:a+b};
}

function requiredPicked(listSel){
  const host = $(listSel);
  const rows = [...host.querySelectorAll(".row")];
  const reqRow = rows.find(r => r.querySelector(".badge.required"));
  if(!reqRow) return true; // no required game present
  return !!reqRow.querySelector('input[type="radio"]:checked');
}

function validateAll(){
  const nameOk  = !!$("#nameSel").value;
  const emailOk = /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test($("#emailBox").value.trim());

  const {a,b,total} = selectionCounts();
  const reqA = requiredPicked("#listA");
  const reqB = requiredPicked("#listB");

  const atLeastA = a >= 3;
  const atLeastB = b >= 3;
  const rangeOk  = total >= 7 && total <= 12;

  // Double rule: if chosen, it must be one of the current selections
  const dbl = $("#doubleSel").value;
  const chosenQIDs = $$('input[type="radio"]:checked').map(r=>r.name);
  const doubleOk = !dbl || chosenQIDs.includes(dbl);

  // Global picks deadline
  const globalDeadlineOk = (new Date() <= new Date(PICKS_DEADLINE_UTC));

  // Update checklist
  setCheck("#chkName", nameOk);
  setCheck("#chkEmail", emailOk);
  setCheck("#chkReqNFL", reqA);
  setCheck("#chkReqNCAA", reqB);
  setCheck("#chkAtLeastA", atLeastA);
  setCheck("#chkAtLeastB", atLeastB);
  setCheck("#chkRange", rangeOk);
  setCheck("#chkDouble", doubleOk);
  setCheck("#chkDeadline", globalDeadlineOk);

  const allOk = nameOk && emailOk && reqA && reqB && atLeastA && atLeastB && rangeOk && doubleOk && globalDeadlineOk;

  // Status pill
  const pill = $("#statusBox");
  pill.textContent = allOk ? "BEAR DOWN!" : "ERRORS DETECTED";
  pill.classList.toggle("status_good", allOk);
  pill.classList.toggle("status_bad", !allOk);

  // Section counters
  $("#cntA").textContent = `Answered: ${a}`;
  $("#cntB").textContent = `Answered: ${b}`;

  return allOk;
}

function setCheck(sel, ok){
  const li = $(sel);
  li.classList.toggle("check-ok", ok);
  li.classList.toggle("check-bad", !ok);
  li.querySelector(".check-icon").textContent = ok ? "✓" : "✕"; }

/* Double select list = only currently selected, unexpired games */ function refreshDoubleChoices(){
  const sel = $("#doubleSel");
  const keep = sel.value;
  const chosen = $$('input[type="radio"]:checked')
    .map(r => ({ qid:r.name, label: (r.closest(".row").querySelector(".label")?.textContent||"").trim() }))
    // exclude expired (should already be disabled, but double-safe)
    .filter(o => !isExpired($(`.row[data-qid="${CSS.escape(o.qid)}"]`)));

  sel.innerHTML = `<option value="">No double</option>` + chosen
    .map(o => `<option value="${escapeHtml(o.qid)}">${escapeHtml(o.qid)} — ${escapeHtml(o.label)}</option>`)
    .join("");

  if(keep && chosen.some(o=>o.qid===keep)) sel.value = keep; }

/* Summary text for the email and on-screen summary */ function buildSelectionsText(){
  const name  = $("#nameSel").selectedOptions[0]?.textContent || "";
  const email = $("#emailBox").value.trim();
  const stamp = new Date().toISOString();

  // Collate checked radios by section
  const checked = $$('input[type="radio"]:checked').map(r=>{
    const row = r.closest(".row");
    const qid = row.dataset.qid;
    const line= row.querySelector(".label")?.textContent || "";
    const pick= r.value;
    const isExp = isExpired(row);
    return {qid, line, pick, isExp};
  });

  // Sort by QID for stability
  checked.sort((x,y)=>x.qid.localeCompare(y.qid));

  const dbl = $("#doubleSel").value;

  const lines = [];
  lines.push(`Name: ${name}`);
  lines.push(`Email: ${email}`);
  lines.push(`Week: ${CURRENT_WEEK}`);
  lines.push(`Timestamp: ${stamp}`);
  lines.push("");
  lines.push("Selections:");
  checked.forEach(o=>{
    const tag = (o.qid===dbl) ? " [DOUBLE]" : "";
    lines.push(`${o.qid}:${o.pick}${tag}`);
  });

  return lines.join("\n");
}

function renderSummary(){
  const text = buildSelectionsText();
  $("#summary").innerHTML = `<pre style="white-space:pre-wrap">${escapeHtml(text)}</pre>`;
}

/* =============== EVENTS =============== */ document.addEventListener("change", e=>{
  if(e.target.matches('#nameSel')){
    // Fill email from participants list (data-email on option)
    const em = e.target.selectedOptions[0]?.dataset.email || "";
    if(em) $("#emailBox").value = em;
  }
  if(e.target.matches('input[type="radio"]')){
    // Prevent re-click in one section from clearing the other section (radio names differ by QID, so OK).
    refreshDoubleChoices();
    renderSummary();
    validateAll();
  }
  if(e.target.matches('#doubleSel') || e.target.matches('#emailBox')){
    renderSummary();
    validateAll();
  }
});

document.addEventListener("click", e=>{
  if(e.target.matches('.clear')){
    const qid = e.target.dataset.clear;
    $$(`input[type="radio"][name="${CSS.escape(qid)}"]`).forEach(r=>r.checked=false);
    refreshDoubleChoices();
    renderSummary();
    validateAll();
  }
});

/* Submit & Reset */
$("#resetBtn").addEventListener("click", ()=>{
  $$('input[type="radio"]').forEach(r=>r.checked=false);
  $("#doubleSel").value = "";
  renderSummary();
  refreshDoubleChoices();
  validateAll();
});

$("#submitBtn").addEventListener("click", async ()=>{
  // Block after global deadline
  if(new Date() > new Date(PICKS_DEADLINE_UTC)){
    alert("The global picks deadline has passed. Submissions are closed.");
    return;
  }

  const ok = validateAll();
  if(!ok){
    alert("Please fix the items in Checks & Errors before submitting.");
    return;
  }

  // If no double selected, confirm intent
  if(!$("#doubleSel").value){
    const okNoDouble = confirm("Submit with NO Double?");
    if(!okNoDouble) return;
  }

  const participantName = $("#nameSel").selectedOptions[0]?.textContent || "";
  const selectionsText  = buildSelectionsText();

  if(DEMO_MODE){
    $("#demoBadge").hidden = false;
    alert("Submitted! (Demo mode — email suppressed)");
    return;
  }

  // EmailJS — only send the two variables your template expects
  try{
    if(!window.emailjs){
      // load SDK once
      await new Promise((res,rej)=>{
        const s = document.createElement("script");
        s.src = "https://cdn.jsdelivr.net/npm/emailjs-com@3/dist/email.min.js";
        s.onload = res; s.onerror = rej; document.head.appendChild(s);
      });
    }
    emailjs.init(EMAILJS_PUBLIC_KEY);
    const params = { participant_name: participantName, selections_text: selectionsText };
    await emailjs.send(EMAILJS_SERVICE_ID, EMAILJS_TEMPLATE_ID, params);
    alert("Submitted! A copy will be CC’d to you.");
  }catch(err){
    console.error(err);
    alert("Could not send via EmailJS. Check your EmailJS keys/template.");
  }
});

/* =============== LOAD DATA =============== */ async function loadAll(){
  try{
    const [pCSV, aCSV, bCSV] = await Promise.all([
      fetchCSV(CSV_URL_PARTICIPANTS),
      fetchCSV(CSV_URL_NFL),
      fetchCSV(CSV_URL_NCAA),
    ]);

    // Participants
    const people = parseCSV(pCSV); // Name, Email
    $("#nameSel").innerHTML =
      `<option value="">— Select your name —</option>` +
      people
        .map(p => `<option value="${escapeHtml(p.Name)}" data-email="${escapeHtml(p.Email||"")}">${escapeHtml(p.Name)}</option>`)
        .join("");

    // Games
    const aRows = normalizeGames(parseCSV(aCSV), true);
    const bRows = normalizeGames(parseCSV(bCSV), false);

    renderSection($("#listA"), aRows);
    renderSection($("#listB"), bRows);

    refreshExpiryUI();
    refreshDoubleChoices();
    renderSummary();
    validateAll();

    // Re-check expiry every minute
    setInterval(()=>{ refreshExpiryUI(); refreshDoubleChoices(); validateAll(); }, 60_000);

  }catch(e){
    console.error(e);
    $("#listA").textContent = "Failed to load NFL.";
    $("#listB").textContent = "Failed to load NCAA.";
  }
}

loadAll();
</script>
</body>
</html>